### K8 Kubernetes:
kubectl get pods --sort-by=.status.startTime
# kubectl logs <container> -n ibus-cloud-prod $MID0 | sed 's/\\n/\/g’ > logfile.log
kubectl logs <container> -n ibus-cloud-prod $MID0 --tail=100
kubectl describe pod <container> -n ibus-cloud-prod $MID0
kubectl get deployment -n ibus-cloud-prod $MID0
kubectl rollout restart deployment <deployment> -n ibus-cloud-prod $MID0 # there is also $PRES0
kubectl rollout restart deployment <deployment-name> -n <namespace>
    example:
        kubectl rollout restart deployment ibustenantconfig -n ibus-cloud-prod
kubectl delete pod <pod-name> -n <namespace>
kubectl logs <pod_name> > logs.txt
kubectl get deployments --all-namespaces -o custom-columns='NAMESPACE:.metadata.namespace,NAME:.metadata.name,PODS:.status.availableReplicas' | grep -v '^[[:space:]]*[^[:space:]]*[[:space:]]*[1-9][0-9]*[[:space:]]*$'
# if not fed
kubectl get pods --namespace=ibus-cloud-eng
# look for specific pods
kubectl get pods | grep <name> (#if in Fed need the namespace) 
#look thought pod logs
kubectl logs <full name>  | vim - # exmaple kubectl logs hopsschedule-cloudqasystem-5777f69bc7-tn4kz | vim -
kubectl get nodes -o json | jq '.items[] | {addr: .metadata.labels.internal_addr, taints: .spec.taints}'
WHERE
kubectl config view --minify 
kubectl exec -it ibusauthentication-cloudgov-5bb6b6f5d8-6qqjr $MID0 -n ibus-cloud-prod -- bash
##WATCH
watch -n <number> "kubectl get pods -n ibus-cloud-prod | grep <name>
watch -n 1 "kubectl get pods -n ibus-cloud-prod | grep tenantconfig"

## NOT running
kubectl get pods --all-namespaces --field-selector=status.phase!=Running
## Other phases:
kubectl get pods --all-namespaces | grep -E "CrashLoopBackOff|Error|Evicted|Failed|Pending"
## LOOK for persistent volume chains
kubectl get pvc -n <namespace> --field-selector=status.phase=Pending
## list node labels
kubectl get nodes -o json | jq -r '.items[].metadata.labels["node-type"]' | sort -u
## list release from helm
helm list -A
#Replica Sets
kubectl get rs ibustempinfusiondatastore-prodcayul-5995c87c6b -n ibus-cloud-prod
## Scale replica set, scale deployment
##proof
sy018616-mac:~ sy018616$ kubectl describe rs ibustempinfusiondatastore-prodcayul-5995c87c6b -n ibus-cloud-prod | grep Deployment
Controlled By:  Deployment/ibustempinfusiondatastore-prodcayul
## Scale deployment
kubectl scale deployment ibustempinfusiondatastore-prodcayul --replicas=4 -n ibus-cloud-prod

## See desired replica count
kubectl describe rs <deployment name> -n ibus-cloud-prod | grep Replicas
  example: kubectl describe rs ibuscode-prodcayul-58bdd69d5b -n ibus-cloud-prod | grep Replicas
##proof
sy018616-mac:~ sy018616$ kubectl describe rs ibustempinfusiondatastore-prodcayul-5995c87c6b -n ibus-cloud-prod | grep Deployment
Controlled By:  Deployment/ibustempinfusiondatastore-prodcayul
## Scale deployment
kubectl scale deployment ibustempinfusiondatastore-prodcayul --replicas=4 -n ibus-cloud-prod
# Cordon cordon
kubectl cordon <node>
kubectl uncordon <node>
kubectl drain <node> --ignore-daemonsets --delete-emptydir-data

## See if a node has a running pod. Search pods and grep for node, also add namespace
kubectl get pods -A -o wide | grep 170.100.60.122 | grep ibus-cloud-prod

## Print pods in a non-running state
kubectl get pods -n ibus-cloud-prod | grep -E 'ContainerStatusUnknown|Error|Evicted|ImagePullBackOff|CrashLoopBackOff' | awk '{print $1}' 

## Delete pods in a non running state
kubectl get pods -n ibus-cloud-prod | grep -E 'ContainerStatusUnknown|Error|Evicted' | awk '{print $1}' | xargs kubectl delete pod -n ibus-cloud-prod
## get rabbit admin
kubectl get secret rabbitmq-01-nonprodusord-default-user -o jsonpath='{.data.password}' | base64 --decode

# tunapoke 8181
sy018616-mac:tunapoke sy018616$ lsof -i :8181
COMMAND  PID    USER  FD  TYPE            DEVICE SIZE/OFF NODE NAME
Python 69646 sy018616   3u IPv4 0xb3af473774df7821     0t0 TCP *:8181 (LISTEN)
sy018616-mac:tunapoke sy018616$ kill -9 69646
ran ./tunapoke

# cycle rabbit
kubectl rollout restart statefulset -n ibus-cloud-prod rabbitmq-01-nonprodusord-server

# Find all connect named pods with given status
kubectl get pods -n ibus-cloud-prod \
| grep -E '^connect.*(ContainerStatusUnknown|Error|Evicted)' \
| awk '{print $1}'



# Find and delete all connect named pods with given status
kubectl get pods -n ibus-cloud-prod \
| grep -E '^connect.*(ContainerStatusUnknown|Error|Evicted)' \
| awk '{print $1}' \
| xargs kubectl delete pod -n ibus-cloud-prod


### PIN back to previous replica set 
kubectl describe rs reportingcollector-produsord-67f78f486c | grep “deployment.kubernetes.io/revision”
        deployment.kubernetes.io/revision: 18
kubectl rollout undo deployment reportingcollector-produsord --to-revision=18
#### other means to undo deployment 
kubectl rollout undo deployment reportingcollector-produsord
kubectl delete rs reportingcollector-produsord-7448f95598

